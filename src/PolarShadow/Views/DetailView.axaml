<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ps="https://github.com/PolarShadow"
             xmlns:pss="using:PolarShadow.Services"
			 xmlns:psr="using:PolarShadow.Resources"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="PolarShadow.Views.DetailView"
             x:DataType="ps:DetailViewModel"
             x:CompileBindings="True"
             ps:PageLoadAttached.RegisterLoad="True">
	<ps:ToolBarAttached.ToolBar>
		<ps:ToolBarTemplate ToolBar="{x:Static ps:TopLayoutViewModel.RightTitleBarContainer}">
			<Button Theme="{StaticResource Icon}"
		            Classes.save="{Binding !IsSaved}"
		            Classes.delete="{Binding IsSaved}"
		            VerticalAlignment="Center"
		            Command="{Binding ResourceOperateCommand}"
					IsEnabled="{Binding !IsLoading}">
				<Button.Styles>
					<Style Selector="Button.save">
						<Setter Property="Content" Value="&#xF0B1;"/>
					</Style>
					<Style Selector="Button.delete">
						<Setter Property="Content" Value="&#xEC2A;"/>
					</Style>
				</Button.Styles>
			</Button>
		</ps:ToolBarTemplate>
	</ps:ToolBarAttached.ToolBar>
	
    <Grid Margin="10"
		  x:Name="part_container">
		<FlyoutBase.AttachedFlyout>
			<Flyout Placement="Center">
				<ItemsControl ItemsSource="{Binding WebAnalysisSites}">
					<ItemsControl.ItemsPanel>
						<ItemsPanelTemplate>
							<WrapPanel/>
						</ItemsPanelTemplate>
					</ItemsControl.ItemsPanel>
					<ItemsControl.ItemTemplate>
						<DataTemplate DataType="psr:IWebAnalysisSite">
							<Button Content="{Binding Title}"
									Command="{Binding $parent[UserControl].((ps:DetailViewModel)DataContext).WebAnalysisSelectedCommand}"
									CommandParameter="{Binding}"/>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</Flyout>
		</FlyoutBase.AttachedFlyout>
        <ScrollViewer>
            <StackPanel Orientation="Vertical"
                        Spacing="10">
                <Image Width="{StaticResource CardItemWidth}"
					   Height="{StaticResource CardItemHeight}"
                       HorizontalAlignment="Center"
                       ps:ImageAttached.Src="{Binding Resource.ImageSrc}"
                       ps:ImageAttached.Cache="{Binding ImageCache}"
					   ps:ImageAttached.Headers="{Binding Resource.ImageSrcHeaders}"/>
                <SelectableTextBlock Text="{Binding Resource.Name}" 
                                     HorizontalAlignment="Center"/>
                <TextBlock Text="简介"
                           Classes="title"/>
                <TextBlock Text="{Binding Resource.Description}" TextWrapping="Wrap"/>
                <TextBlock Text="来源"
                           Classes="title"/>
                <SelectableTextBlock Text="{Binding Resource.Site}"/>
                <TextBlock Text="剧集"
                           Classes="title"/>
                <ItemsControl ItemsSource="{Binding Resource.Children}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="pss:ResourceTreeNode">
                            <StackPanel Orientation="Vertical"
                                        Spacing="10">
                                <TextBlock Text="{Binding Name}"/>
                                <ItemsControl ItemsSource="{Binding Children}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="pss:ResourceTreeNode">
                                            <Button Content="{Binding Name}"
                                                    Margin="8">
                                                <Button.Flyout>
                                                    <Flyout>
                                                        <ItemsControl ItemsSource="{Binding Children}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
																	<Button Content="{Binding SrcType}"
                                                                            MinWidth="80"
                                                                            MinHeight="30"
                                                                            VerticalContentAlignment="Center"
                                                                            HorizontalContentAlignment="Center"
                                                                            Command="{Binding $parent[UserControl].((ps:DetailViewModel)DataContext).LinkClickCommand}"
                                                                            CommandParameter="{Binding}"/>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </Flyout>
                                                </Button.Flyout>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
        </StackPanel>
        </ScrollViewer>

        <Button Theme="{StaticResource Icon}"
                Content="&#xF064;"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Margin="20"
                Command="{Binding RefreshCommand}"/>
        <Border IsVisible="{Binding IsLoading}" 
				Background="Transparent">
            <PathIcon Data="{StaticResource loader2}"
                      Classes.spin="{Binding IsLoading}"
                      Height="30"
                      Width="30"/>
        </Border>
	</Grid>
</UserControl>
