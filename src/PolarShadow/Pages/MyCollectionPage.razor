@page "/"
@layout MainLayout
@inject IMyCollectionService _myCollectionService
@inject INavigationService _nav
@inject IStateContext _context

<Layout>
    <Header>
        <GridRow Gutter="16" Class="header-content">
            <GridCol Flex=@("auto")>
                <Tabs Centered OnChange="@TabChange">
                    @foreach (var tab in _tabs)
                    {
                        <TabPane Tab="@tab.Value" Key="@tab.Key">

                        </TabPane>
                    }
                </Tabs>
            </GridCol>
            <GridCol Flex=@("none")>
                <Icon Type="search" Theme="outline" OnClick="@SearchClick" Class="cursor-point-style"/>
            </GridCol>
            <GridCol Flex=@("none") Offset="-1">
                <Icon Type="more" Theme="outline" />
            </GridCol>
        </GridRow>

    </Header>
    <Content Class="scroll-content">
        <AntList Grid="grid" TItem="VideoSummary" DataSource="@_source">
            <ListItem OnClick="()=>ItemClick(context)">
                <VideoCard Summary="@(context)"/>
            </ListItem>
        </AntList>
    </Content>
</Layout>

<style>

</style>

@code {
    private Dictionary<string, string> _tabs = new Dictionary<string, string>
    {
        {"all", "全部"}
    };

    private ListGridType grid = new ListGridType
    {
        Gutter = 16,
        Xs = 2,
        Sm = 2,
        Md = 4,
        Lg = 4,
        Xl = 6,
        Xxl = 8
    };

    private ICollection<VideoSummary> _source;

    private async void TabChange(string tab)
    {
        if (tab == "all")
        {
            _source = await _myCollectionService.GetMyCollectionAsync(1, 10);
        }
    }

    private void SearchClick(MouseEventArgs arg)
    {
        _nav.NavigateTo("/search", true);
    }

    private void ItemClick(VideoSummary summary)
    {
        _nav.NavigateTo("/detail", new Dictionary<string, object>()
        {
            {DetailPage._summaryKey, summary}
        }, true);
    }

}
